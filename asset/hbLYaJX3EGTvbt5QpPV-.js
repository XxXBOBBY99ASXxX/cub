var f=Object.defineProperty;var w=(u,t,e)=>t in u?f(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e;var p=(u,t,e)=>(w(u,typeof t!="symbol"?t+"":t,e),e);import{G as g}from"./p92OKrTFGeG4VzMCmQFU.js";import{L as y}from"./85yZmE5PqfcNKC64qTgv.js";const l={"User-Agent":"Spacebar-Client/1.0",accept:"application/json"};class d{constructor(t){p(this,"logger",new y("REST"));p(this,"app");p(this,"headers");this.app=t,this.headers=l}setToken(t){t?this.headers.Authorization=t:delete this.headers.Authorization}static async getEndpointsFromDomain(t){try{return await this.getInstanceDomains(t,t)}catch{}const e=await fetch(`${t.origin}/.well-known/spacebar`,{method:"GET",headers:l,mode:"cors"}).then(n=>n.json()).then(n=>new URL(n.api));return await this.getInstanceDomains(e,t)}static async getInstanceDomains(t,e){const n=await fetch(`${t.toString()}${t.pathname.includes("api")?"":"api"}/policies/instance/domains`,{method:"GET",headers:l,mode:"cors"}).then(i=>i.json());return{api:n.apiEndpoint,gateway:n.gateway,cdn:n.cdn,wellknown:e.toString()}}static makeAPIUrl(t,e={}){const n=new URL(`${g.routeSettings.api}${t}`);return Object.entries(e).forEach(([i,r])=>{n.searchParams.append(i,r)}),n.toString()}static makeCDNUrl(t,e={}){const n=new URL(`${g.routeSettings.cdn}${t}`);return Object.entries(e).forEach(([i,r])=>{n.searchParams.append(i,r)}),n.toString()}async get(t,e={}){return new Promise((n,i)=>{const r=d.makeAPIUrl(t,e);return fetch(r,{method:"GET",headers:this.headers,mode:"cors"}).then(async a=>{var h;if(a.headers.get("content-length")!=="0")return(h=a.headers.get("content-type"))!=null&&h.includes("application/json")?a.ok?a.json():i(await a.json()):a.ok?a.text():i(a.json())}).then(n).catch(i)})}async post(t,e,n={},i={}){return new Promise((r,a)=>{const h=d.makeAPIUrl(t,n);return this.logger.debug(`POST ${h}; payload:`,e),fetch(h,{method:"POST",headers:{...i,...this.headers,"Content-Type":"application/json"},body:e?JSON.stringify(e):void 0,mode:"cors"}).then(async s=>{var o;if((o=s.headers.get("content-type"))!=null&&o.includes("application/json")){const c=await s.json();return s.ok?r(c):a(c)}if(s.headers.get("content-length")!=="0"){const c=await s.text();return s.ok?r(c):a(c)}return s.ok?r(s.status):a(s.statusText)}).catch(a)})}async put(t,e,n={},i={}){return new Promise((r,a)=>{const h=d.makeAPIUrl(t,n);return this.logger.debug(`PUT ${h}; payload:`,e),fetch(h,{method:"PUT",headers:{...i,...this.headers,"Content-Type":"application/json"},body:e?JSON.stringify(e):void 0,mode:"cors"}).then(async s=>{var o;if((o=s.headers.get("content-type"))!=null&&o.includes("application/json")){const c=await s.json();return s.ok?r(c):a(c)}if(s.headers.get("content-length")!=="0"){const c=await s.text();return s.ok?r(c):a(c)}return s.ok?r(s.status):a(s.statusText)}).catch(a)})}async postFormData(t,e,n={},i={},r){return new Promise((a,h)=>{const s=d.makeAPIUrl(t,n);this.logger.debug(`POST ${s}; payload:`,e);const o=new XMLHttpRequest;r&&(r.setAbortCallback(()=>{this.logger.debug("[PostFormData]: Message called abort"),o.abort(),h("aborted")}),o.upload.addEventListener("progress",c=>r.updateProgress(c))),o.addEventListener("loadend",()=>o.status>=200&&o.status<300?o.responseType==="json"?a(o.response):a(JSON.parse(o.response)):o.getResponseHeader("content-length")!=="0"?h(o.responseText):h(o.statusText)),o.open("POST",s),Object.entries({...i,...this.headers}).forEach(([c,m])=>{o.setRequestHeader(c,m)}),o.send(e)})}async delete(t,e={},n={}){return new Promise((i,r)=>{const a=d.makeAPIUrl(t,e);return this.logger.debug(`DELETE ${a}`),fetch(a,{method:"DELETE",headers:{...n,...this.headers},mode:"cors"}).then(()=>i()).catch(r)})}}export{d as R};
//# sourceMappingURL=hbLYaJX3EGTvbt5QpPV-.js.map
