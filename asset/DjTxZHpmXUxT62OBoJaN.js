var _=Object.defineProperty;var b=(n,r,t)=>r in n?_(n,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[r]=t;var o=(n,r,t)=>(b(n,typeof r!="symbol"?r+"":r,t),t);import{ai as a,aj as c,ak as g,aG as w,C as e,ag as P,aa as m,aM as G}from"./DEYDuN7xp-m3cL830AkD.js";import{L as M}from"./85yZmE5PqfcNKC64qTgv.js";import{P as f}from"./B8a7_oPVuhqv4mSPchaN.js";import{M as A}from"./CTg__Jc6LMOU2wRH3uEA.js";var k=Object.defineProperty,L=Object.getOwnPropertyDescriptor,i=(n,r,t,d)=>{for(var p=d>1?void 0:d?L(r,t):r,h=n.length-1,l;h>=0;h--)(l=n[h])&&(p=(d?l(r,t,p):l(p))||p);return d&&p&&k(r,t,p),p};class s{constructor(r,t){o(this,"logger",new M("Channel"));o(this,"app");o(this,"id");o(this,"createdAt");o(this,"name");o(this,"icon");o(this,"type");o(this,"recipients");o(this,"lastMessageId");o(this,"guildId");o(this,"parentId");o(this,"ownerId");o(this,"lastPinTimestamp");o(this,"defaultAutoArchiveDuration");o(this,"position");o(this,"permissionOverwrites");o(this,"videoQualityMode");o(this,"bitrate");o(this,"userLimit");o(this,"nsfw");o(this,"rateLimitPerUser");o(this,"topic");o(this,"invites");o(this,"retentionPolicyId");o(this,"messages");o(this,"voiceStates");o(this,"readStates");o(this,"webhooks");o(this,"flags");o(this,"defaultThreadRateLimitPerUser");o(this,"channelIcon");o(this,"typingIds");o(this,"typing",null);o(this,"hasFetchedInitialMessages",!1);switch(this.app=r,this.typingIds=new w,this.id=t.id,this.createdAt=new Date(t.created_at),this.name=t.name,this.icon=t.icon,this.type=t.type,this.recipients=t.recipients,this.lastMessageId=t.last_message_id,this.guildId=t.guild_id,this.parentId=t.parent_id,this.ownerId=t.owner_id,this.lastPinTimestamp=t.last_pin_timestamp,this.defaultAutoArchiveDuration=t.default_auto_archive_duration,this.position=t.position,this.permissionOverwrites=t.permission_overwrites??[],this.videoQualityMode=t.video_quality_mode,this.bitrate=t.bitrate,this.userLimit=t.user_limit,this.nsfw=t.nsfw,this.rateLimitPerUser=t.rate_limit_per_user,this.topic=t.topic,this.invites=t.invites,this.retentionPolicyId=t.retention_policy_id,this.voiceStates=t.voice_states,this.readStates=t.read_states,this.webhooks=t.webhooks,this.flags=t.flags,this.defaultThreadRateLimitPerUser=t.default_thread_rate_limit_per_user,this.messages=new A(r,this.id),t.messages&&this.messages.addAll(t.messages),this.type){case e.GuildText:this.channelIcon="mdiPound";break;case e.GuildVoice:this.channelIcon="mdiVolumeHigh";break;case e.GuildAnnouncement:case e.AnnouncementThread:this.channelIcon="mdiBullhornVariant";break;case e.GuildStore:case e.Transactional:this.channelIcon="mdiStore";break;case e.Encrypted:case e.EncryptedThread:this.channelIcon="mdiLock";break;case e.PublicThread:case e.PrivateThread:this.channelIcon="mdiCommentMultipleOutline";break;case e.GuildStageVoice:this.channelIcon="mdiBroadcast";break;case e.GuildForum:this.channelIcon="mdiForumOutline";break;case e.TicketTracker:this.channelIcon="mdiTicketOutline";break;case e.KanBan:this.channelIcon="mdiDeveloperBoard";break;case e.VoicelessWhiteboard:this.channelIcon="mdiDraw";break;case e.GuildDirectory:this.channelIcon="mdiFolder";break}P(this)}update(r){Object.assign(this,r)}getMessages(r,t,d,p,h,l){return new Promise((I,v)=>{if(t&&this.hasFetchedInitialMessages)return;let u={limit:d||50};p&&(u={...u,before:p}),h&&(u={...u,after:h}),l&&(u={...u,around:l}),t?this.logger.info(`Fetching initial messages for ${this.id}`):this.logger.info(`Fetching messages for ${this.id} before ${p}`),r.rest.get(m.channelMessages(this.id),u).then(y=>{if("code"in y){this.logger.error(y);return}this.messages.addAll(y.filter(T=>!this.messages.has(T.id))),this.hasFetchedInitialMessages=!0,I(y.length)}).catch(y=>{this.logger.error(y),v(y)})})}async sendMessage(r,t){return r instanceof FormData?this.app.rest.postFormData(m.channelMessages(this.id),r,void 0,void 0,t):this.app.rest.post(m.channelMessages(this.id),r)}get isTextChannel(){return this.type===e.GuildText||this.type===e.GuildVoice||this.type===e.GuildStageVoice||this.type===e.GuildForum||this.type===e.GuildAnnouncement||this.type===e.AnnouncementThread||this.type===e.Encrypted||this.type===e.EncryptedThread||this.type===e.PrivateThread||this.type===e.PublicThread||this.type===e.GroupDM||this.type===e.DM}get isGuildTextChannel(){return this.type===e.GuildText||this.type===e.GuildVoice||this.type===e.GuildStageVoice||this.type===e.GuildForum||this.type===e.GuildAnnouncement||this.type===e.AnnouncementThread||this.type===e.Encrypted||this.type===e.EncryptedThread||this.type===e.PrivateThread||this.type===e.PublicThread}get typingUsers(){return Array.from(this.typingIds.keys()).map(r=>this.app.users.get(r)).filter(r=>r&&r.id!==this.app.account.id)}hasPermission(r){return f.getPermission(this.app.account.id,this.guildId?this.app.guilds.get(this.guildId):void 0,this).has(r)}async startTyping(){this.typing&&this.typing>Date.now()||(this.logger.debug("Client user has started typing"),this.typing=Date.now()+1e4,await this.app.rest.post(m.channelTyping(this.id)))}stopTyping(r){(r||this.typing)&&(this.logger.debug("Client user has stopped typing"),this.typing=null)}get guild(){if(this.guildId)return this.app.guilds.get(this.guildId)}get listId(){let r="everyone";const t=[];for(const d of this.permissionOverwrites){const{id:p,allow:h,deny:l}=d;h.toBigInt()&f.FLAGS.VIEW_CHANNEL?t.push(`allow:${p}`):l.toBigInt()&f.FLAGS.VIEW_CHANNEL&&t.push(`deny:${p}`)}return t.length&&(r=G(t.sort().join(",")).toString()),r}}i([a],s.prototype,"name",2);i([a],s.prototype,"icon",2);i([a],s.prototype,"recipients",2);i([a],s.prototype,"lastMessageId",2);i([a],s.prototype,"parentId",2);i([a],s.prototype,"lastPinTimestamp",2);i([a],s.prototype,"defaultAutoArchiveDuration",2);i([a],s.prototype,"position",2);i([a],s.prototype,"permissionOverwrites",2);i([a],s.prototype,"videoQualityMode",2);i([a],s.prototype,"bitrate",2);i([a],s.prototype,"userLimit",2);i([a],s.prototype,"nsfw",2);i([a],s.prototype,"rateLimitPerUser",2);i([a],s.prototype,"topic",2);i([a],s.prototype,"invites",2);i([a],s.prototype,"retentionPolicyId",2);i([a],s.prototype,"messages",2);i([a],s.prototype,"voiceStates",2);i([a],s.prototype,"readStates",2);i([a],s.prototype,"webhooks",2);i([a],s.prototype,"flags",2);i([a],s.prototype,"defaultThreadRateLimitPerUser",2);i([a],s.prototype,"channelIcon",2);i([a],s.prototype,"typingIds",2);i([a],s.prototype,"typing",2);i([c],s.prototype,"update",1);i([c],s.prototype,"getMessages",1);i([c],s.prototype,"sendMessage",1);i([g],s.prototype,"isTextChannel",1);i([g],s.prototype,"isGuildTextChannel",1);i([g],s.prototype,"typingUsers",1);i([c],s.prototype,"startTyping",1);i([c],s.prototype,"stopTyping",1);i([g],s.prototype,"guild",1);i([g],s.prototype,"listId",1);export{s as C};
//# sourceMappingURL=DjTxZHpmXUxT62OBoJaN.js.map
